<!DOCTYPE html>
<html>
<head>
  <title>Payment List</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffe6ea;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }
    h2, h3 {
      color: #d6336c;
    }
    input, button {
      margin: 5px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #d6336c;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #bf2b5b;
    }
    .paid {
      text-decoration: line-through;
      color: gray;
    }
    ul {
      list-style-type: none;
      padding: 0;
      width: 350px;
    }
    li {
      background: white;
      margin: 5px 0;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .entry-content {
      flex-grow: 1;
    }
    .delete-btn {
      background-color: #ff5c5c;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      color: white;
      margin-left: 10px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background-color: #e04b4b;
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
  </style>
</head>
<body>
  <h2>Payment List</h2>
  <input type="text" id="nameInput" placeholder="Name">
  <input type="number" id="priceInput" placeholder="Price">
  <button onclick="addEntry()">Add</button>

  <ul id="paymentList"></ul>

  <h3>Paid People</h3>
  <table id="paidTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Amount Paid</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <br>
  <button onclick="downloadCSV()">Download Paid CSV</button>
  <button onclick="printPaidTable()">Print Table</button>
  <button onclick="downloadFullIndex()">Download Full Index</button>

  <script>
    let payments = JSON.parse(localStorage.getItem('payments')) || [];

    function savePayments() {
      localStorage.setItem('payments', JSON.stringify(payments));
    }

    function deleteEntry(index) {
      payments.splice(index, 1);
      savePayments();
      renderList();
    }

    function renderList() {
      const list = document.getElementById("paymentList");
      const paidTableBody = document.querySelector("#paidTable tbody");
      list.innerHTML = '';
      paidTableBody.innerHTML = '';

      payments.forEach((entry, index) => {
        // Main list
        const li = document.createElement("li");

        const contentDiv = document.createElement("div");
        contentDiv.className = "entry-content";

        const label = document.createElement("label");
        label.innerText = `${entry.name} - $${parseFloat(entry.price).toFixed(2)} `;
        if (entry.paid) label.classList.add("paid");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = entry.paid;
        checkbox.onchange = function () {
          payments[index].paid = checkbox.checked;
          savePayments();
          renderList();
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.innerText = "Delete";
        deleteBtn.onclick = function () {
          deleteEntry(index);
        };

        contentDiv.appendChild(label);
        contentDiv.appendChild(checkbox);
        li.appendChild(contentDiv);
        li.appendChild(deleteBtn);
        list.appendChild(li);

        // Paid Table
        if (entry.paid) {
          const row = document.createElement("tr");
          const nameCell = document.createElement("td");
          const priceCell = document.createElement("td");
          nameCell.textContent = entry.name;
          priceCell.textContent = `$${parseFloat(entry.price).toFixed(2)}`;
          row.appendChild(nameCell);
          row.appendChild(priceCell);
          paidTableBody.appendChild(row);
        }
      });
    }

    function addEntry() {
      const name = document.getElementById("nameInput").value.trim();
      const price = document.getElementById("priceInput").value;
      if (!name || !price) return;

      payments.push({ name, price, paid: false });
      savePayments();
      renderList();

      document.getElementById("nameInput").value = '';
      document.getElementById("priceInput").value = '';
    }

    function getTimestamp() {
      const now = new Date();
      return now.toISOString().split("T")[0] + "_" + now.toTimeString().split(" ")[0].replace(/:/g, "-");
    }

    function downloadCSV() {
      const rows = [["Name", "Amount Paid"]];
      payments.forEach(entry => {
        if (entry.paid) {
          rows.push([entry.name, parseFloat(entry.price).toFixed(2)]);
        }
      });

      let csvContent = "data:text/csv;charset=utf-8," 
        + rows.map(e => e.join(",")).join("\n");

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "paid_people_" + getTimestamp() + ".csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function downloadFullIndex() {
      const rows = [["Name", "Amount", "Paid"]];
      payments.forEach(entry => {
        rows.push([
          entry.name,
          parseFloat(entry.price).toFixed(2),
          entry.paid ? "Yes" : "No"
        ]);
      });

      let csvContent = "data:text/csv;charset=utf-8," 
        + rows.map(e => e.join(",")).join("\n");

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "payment_index_" + getTimestamp() + ".csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function printPaidTable() {
      const table = document.getElementById("paidTable").outerHTML;
      const printWindow = window.open("", "", "width=800,height=600");
      printWindow.document.write(\`
        <html>
        <head><title>Print Paid Table</title></head>
        <body>
          <h2>Paid People</h2>
          \${table}
        </body>
        </html>
      \`);
      printWindow.document.close();
      printWindow.print();
    }

    renderList();
  </script>
</body>
</html>
